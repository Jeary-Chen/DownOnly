# DownOnly
**ä¸€æ¬¾ä¸“ä¸ºå¢žåŠ ä¸‹è¡Œæµé‡è®¾è®¡çš„è½»é‡çº§å·¥å…·**

[![Go Version](https://img.shields.io/badge/Go-1.22+-00ADD8?style=flat&logo=go)](https://golang.org)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/Platform-Linux-blue)](https://github.com/EchoPing07/DownOnly/releases)

---

## ðŸ“– é¡¹ç›®èƒŒæ™¯

åœ¨å½“å‰å®½å¸¦è¿è¥çŽ¯å¢ƒä¸‹ï¼Œè®¸å¤š **NAS ç”¨æˆ·ã€PT çŽ©å®¶æˆ–è‡ªå»ºæœåŠ¡ç”¨æˆ·** ç”±äºŽä¸Šä¼ æµé‡ä¸Žä¸‹è½½æµé‡æ¯”ä¾‹å¼‚å¸¸ï¼Œå®¹æ˜“è¢«è¿è¥å•†çš„å¤§æ•°æ®ç®—æ³•è¯¯åˆ¤ä¸º"å•†ä¸š PCDN"è¡Œä¸ºï¼Œå¯¼è‡´ï¼š
- ðŸš« è¢«é™é€Ÿç”šè‡³åœç½‘
- ðŸ“ å¼ºåˆ¶è¦æ±‚ç­¾è®¢ä¿è¯ä¹¦
- ðŸ“ž é¢‘ç¹æŽ¥åˆ°"è­¦å‘Š"ç”µè¯

**DownOnly** é€šè¿‡äº§ç”ŸçœŸå®žä½†"æ— å®³"çš„ä¸‹è½½æµé‡ï¼Œåœ¨ä¸æŸè€—ç¡¬ä»¶å¯¿å‘½çš„å‰æä¸‹ï¼Œå¹³è¡¡ä½ çš„å®½å¸¦ä¸Šä¸‹è¡Œæ¯”ä¾‹ï¼Œè§„é¿è¿è¥å•†çš„å¼±æ™ºåˆ¤æ–­ç®—æ³•ã€‚

> **å£°æ˜Ž**ï¼šæˆ‘ä¸æŽ¨èä»»ä½•æµªè´¹å…¬å…±ç½‘ç»œèµ„æºçš„è¡Œä¸ºï¼Œä½†ä¹Ÿä¸å¸Œæœ›è‡ªèº«åˆæ³•åˆè§„çš„è¡Œä¸ºè¢«å¥—ä¸ŠèŽ«é¡»æœ‰çš„ç½ªåã€‚

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ðŸ›¡ï¸ é›¶æŸè€—è®¾è®¡
- **é»‘æ´žæœºåˆ¶**ï¼šé‡‡ç”¨ `io.Discard` æŠ€æœ¯ï¼Œä¸‹è½½æ•°æ®åœ¨å†…å­˜ä¸­ç›´æŽ¥ä¸¢å¼ƒï¼Œ**0 ç£ç›˜å†™å…¥**
- **é—ªå­˜å‹å¥½**ï¼šä¿æŠ¤ eMMCã€SSD ç­‰å­˜å‚¨ä»‹è´¨çš„ç¡¬ä»¶å¯¿å‘½
- **ä½Žå†…å­˜å ç”¨**ï¼šè¿è¡Œæ—¶ä»…å ç”¨ **6-15MB** å†…å­˜ï¼Œ512MB è®¾å¤‡ä¹Ÿèƒ½æµç•…è¿è¡Œ

### ðŸ“Š ä¸“ä¸šå®¡è®¡ç³»ç»Ÿ
- **å®žæ—¶ç›‘æŽ§**ï¼šMbps çº§é€ŸçŽ‡ç»Ÿè®¡ + ç§’çº§æŠ˜çº¿å›¾
- **æµé‡ç»Ÿè®¡**ï¼šæŒ‰æ—¥è®°å½•æµé‡å¹¶ä»¥æŸ±çŠ¶å›¾å±•ç¤ºï¼Œæ”¯æŒæŒ‰æœˆæŸ¥çœ‹åŽ†å²
- **æ•°æ®æŒä¹…åŒ–**ï¼šè‡ªåŠ¨å½’æ¡£å¹´åº¦æ•°æ®

### ðŸ§  æ™ºèƒ½è°ƒåº¦å¼•æ“Ž
- **æ—¶é—´çª—å£**ï¼šè‡ªå®šä¹‰æ¯æ—¥è¿è¡Œæ—¶é—´æ®µï¼ˆå¦‚ä»…åœ¨ 18:00 - 23:00 è¿è¡Œï¼‰
- **é™é¢ä¿æŠ¤**ï¼šè®¾ç½®æ¯æ—¥æµé‡å°é¡¶å€¼ï¼Œè¾¾åˆ°åŽè‡ªåŠ¨å¾…æœº
- **ä¼ªè£…æŠ€æœ¯**ï¼šéšæœºåŒ– User-Agent + å¤šæºè½®æ¢ï¼Œæ¨¡æ‹Ÿæ­£å¸¸ç”¨æˆ·è¡Œä¸º

### ðŸŽ¨ çŽ°ä»£åŒ– WebUI
- **æ·±è‰²/æµ…è‰²æ¨¡å¼** è‡ªç”±åˆ‡æ¢
- **å“åº”å¼è®¾è®¡**ï¼šå®Œç¾Žé€‚é…æ‰‹æœºã€å¹³æ¿ã€PC
- **äº¤äº’å‹å¥½**ï¼šæ‰€æœ‰é…ç½®å¯åœ¨ç½‘é¡µç«¯å®žæ—¶ä¿®æ”¹ï¼Œæ— éœ€é‡å¯

---

## ðŸš€ éƒ¨ç½²æŒ‡å—

### æ–¹å¼ä¸€ï¼šä¸€é”®å®‰è£…ï¼ˆæŽ¨èï¼‰

**é€‚ç”¨äºŽ Linux ç³»ç»Ÿï¼ˆx86_64 / ARM64ï¼‰ï¼Œè‡ªåŠ¨å¤„ç†æ‰€æœ‰ä¾èµ–å’Œé…ç½®ã€‚**

```bash
curl -fsSL https://raw.githubusercontent.com/EchoPing07/DownOnly/main/install.sh | bash
```

**å®‰è£…è¿‡ç¨‹è¯´æ˜Žï¼š**
1. è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿæž¶æž„
2. ä»Ž GitHub Release ä¸‹è½½é¢„ç¼–è¯‘æ–‡ä»¶ï¼ˆè‹¥æ— åˆ™æœ¬åœ°ç¼–è¯‘ï¼‰
3. é…ç½® systemd æœåŠ¡
4. å®‰è£…ç®¡ç†è„šæœ¬åˆ°ç³»ç»Ÿ

**å®‰è£…å®ŒæˆåŽï¼š**
- è®¿é—®åœ°å€ï¼š`http://ä½ çš„è®¾å¤‡IP:8080`
- ç®¡ç†å‘½ä»¤ï¼šç›´æŽ¥è¾“å…¥ `downonly` å‘¼å‡ºç®¡ç†èœå•

---

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

#### 1. å‰ç½®å‡†å¤‡

**æ£€æŸ¥ç«¯å£å ç”¨**ï¼ˆDownOnly é»˜è®¤ä½¿ç”¨ `8080` ç«¯å£ï¼‰ï¼š
```bash
# æ£€æŸ¥ 8080 ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tuln | grep 8080
# æˆ–
lsof -i:8080

# å¦‚æžœæœ‰è¾“å‡ºï¼Œè¯´æ˜Žç«¯å£è¢«å ç”¨ï¼Œè¯·å…ˆå…³é—­å ç”¨è¿›ç¨‹æˆ–ä¿®æ”¹ main.go ä¸­çš„ç«¯å£å·
```

**å®‰è£… Go çŽ¯å¢ƒ**ï¼ˆå¦‚æžœæœªå®‰è£…ï¼‰ï¼š
```bash
# ä¸‹è½½ Goï¼ˆä»¥ ARM64 ä¸ºä¾‹ï¼‰
wget https://golang.google.cn/dl/go1.22.5.linux-arm64.tar.gz
sudo tar -C /usr/local -xzf go1.22.5.linux-arm64.tar.gz

# é…ç½®çŽ¯å¢ƒå˜é‡
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯å®‰è£…
go version
```

#### 2. ç¼–è¯‘ç¨‹åº

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/EchoPing07/DownOnly.git
cd DownOnly

# åˆå§‹åŒ–æ¨¡å—
go mod init downonly

# ç¼–è¯‘
go build -ldflags="-s -w" -o downonly main.go

# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p data
```

#### 3. é…ç½®ç³»ç»ŸæœåŠ¡

```bash
# åˆ›å»º systemd æœåŠ¡æ–‡ä»¶
sudo tee /etc/systemd/system/downonly.service > /dev/null <<EOF
[Unit]
Description=DownOnly Traffic Guard
After=network.target

[Service]
WorkingDirectory=$(pwd)
ExecStart=$(pwd)/downonly
Restart=always
RestartSec=5
StandardOutput=append:$(pwd)/data/sys_out.log
StandardError=append:$(pwd)/data/sys_err.log

[Install]
WantedBy=multi-user.target
EOF

# é‡è½½å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable downonly
sudo systemctl start downonly

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
sudo systemctl status downonly
```

#### 4. è®¿é—® Web ç•Œé¢

åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼š`http://ä½ çš„è®¾å¤‡IP:8080`

---
### æ–¹å¼ä¸‰ï¼šDocker éƒ¨ç½²

**Docker Run è¿è¡Œï¼š**

```bash
docker run -d \
  --name downonly \
  -p 8080:8080 \
  -v /opt/downonly/data:/app/data \
  --restart always \
  ghcr.io/echoping07/downonly:latest
```

**Docker Compose è¿è¡Œï¼š**

åˆ›å»º `docker-compose.yml` æ–‡ä»¶ï¼š
```yaml
services:
  downonly:
    image: ghcr.io/echoping07/downonly:latest
    container_name: downonly
    ports:
      - "8080:8080"
    volumes:
      - ./data:/app/data
    restart: always
```
è¿è¡Œå‘½ä»¤ï¼š
```bash
docker-compose up -d
```

---
## ðŸŽ® ç®¡ç†å‘½ä»¤

å®‰è£…å®ŒæˆåŽï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ç®¡ç†æœåŠ¡ï¼š

```bash
downonly  # å‘¼å‡ºå¯è§†åŒ–ç®¡ç†èœå•
```

**èœå•é€‰é¡¹ï¼š**
- `1` - å¯åŠ¨æœåŠ¡
- `2` - åœæ­¢æœåŠ¡
- `3` - é‡å¯æœåŠ¡
- `4` - æŸ¥çœ‹å®žæ—¶æ—¥å¿—
- `5` - åœ¨çº¿æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
- `6` - å¸è½½ç¨‹åº
- `0` - é€€å‡ºèœå•

---

## ðŸ“‚ ç›®å½•ç»“æž„

```
DownOnly/
â”œâ”€â”€ downonly              # ä¸»ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶
â”œâ”€â”€ main.go               # åŽç«¯æºä»£ç 
â”œâ”€â”€ index.html            # å‰ç«¯ WebUI
â””â”€â”€ data/                 # æ•°æ®ç›®å½•
    â”œâ”€â”€ config.json       # ç”¨æˆ·é…ç½®
    â”œâ”€â”€ stats.json        # æµé‡ç»Ÿè®¡æ•°æ®
    â”œâ”€â”€ logs.json         # è¯¦ç»†æ—¥å¿—
    â”œâ”€â”€ sys_out.log       # systemd æ ‡å‡†è¾“å‡º
    â””â”€â”€ sys_err.log       # systemd é”™è¯¯æ—¥å¿—
```

---

## ðŸ› ï¸ è¿›é˜¶é…ç½®

### 1. ä¿®æ”¹ä¸‹è½½æº

é»˜è®¤ä½¿ç”¨ Appleã€Ubuntu ç­‰å¤§åŽ‚ CDN åœ°å€ï¼Œå»ºè®®ä¿®æ”¹ä¸ºè¿è¥å•†è‡ªæœ‰ CDNã€‚

åœ¨ WebUI çš„"ç­–ç•¥é…ç½®"ä¸­ï¼Œæ¯è¡Œå¡«å…¥ä¸€ä¸ªä¸‹è½½ç›´é“¾ã€‚ä¾‹å¦‚ï¼š
```
http://updates-http.cdn-apple.com/...
https://releases.ubuntu.com/...
https://speed.cloudflare.com/__down?bytes=1000000000
```

### 2. é™é€Ÿç­–ç•¥å»ºè®®

å»ºè®®ä¸‹è½½é€Ÿåº¦è®¾ä¸º **50Mbps** ï¼Œè¯·æ ¹æ®å®žé™…ç½‘ç»œæƒ…å†µè¿›è¡Œè°ƒæ•´

### 3. æ—¶é—´çª—å£è®¾ç½®

å¯ä»¥è®¾ç½®ä»…åœ¨åŠå¤œæ—¶æ®µè¿è¡Œï¼Œé¿å…å’Œå…¶ä»–è®¾å¤‡æŠ¢å ç½‘ç»œèµ„æºã€‚

### 4. ç«¯å£ä¿®æ”¹

å¦‚æžœ `8080` ç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥åœ¨å¯åŠ¨æ—¶æŒ‡å®šç«¯å£ï¼š
```bash
./downonly 9999  # ä½¿ç”¨ 9999 ç«¯å£
```

æˆ–ä¿®æ”¹ `main.go` ä¸­çš„ `port := "8080"` è¡Œã€‚

---

## ðŸ–¥ï¸ å·²æµ‹è¯•è®¾å¤‡

- âœ… éªé¾™ 410 æ£’å­ (512MB å†…å­˜) - Debian 11
- âœ… ç½‘å¿ƒäº‘ OEC (2GB å†…å­˜) - fnOS 1.1.19

---

## ðŸ”§ æ•…éšœæŽ’æŸ¥

### 1. æ— æ³•è®¿é—® WebUI
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status downonly

# æŸ¥çœ‹æ—¥å¿—
tail -f /root/downonly/data/sys_err.log

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tuln | grep 8080
```

### 2. æµé‡ç»Ÿè®¡ä¸å‡†ç¡®
- æ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦æ­£ç¡®ï¼ˆ`date`ï¼‰
- ç¡®è®¤ `data/stats.json` æ–‡ä»¶æƒé™æ­£å¸¸

### 3. å†…å­˜å ç”¨è¿‡é«˜
- æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ªå®žä¾‹åœ¨è¿è¡Œï¼ˆ`ps aux | grep downonly`ï¼‰
- é™ä½Žä¸‹è½½é€ŸçŽ‡é™åˆ¶

---

## âš–ï¸ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT License** å¼€æºã€‚

---

## âš ï¸ å…è´£å£°æ˜Ž

1. æœ¬å·¥å…·**ä»…ç”¨äºŽä¸ªäººå­¦ä¹ ç¼–ç¨‹ä»¥åŠè¯„ä¼°å®½å¸¦ç½‘ç»œçŠ¶å†µ**ã€‚
2. è¯·åœ¨å½“åœ°æ³•å¾‹åŠè¿è¥å•†åè®®å…è®¸èŒƒå›´å†…ä½¿ç”¨ã€‚
3. ç”¨æˆ·éœ€**è‡ªè¡Œæ‰¿æ‹…**å› å¼‚å¸¸æµé‡å¯èƒ½å¼•å‘çš„è¿è¥å•†é£Žé™©ã€‚
4. ä½œè€…ä¸å¯¹ä»»ä½•å› ä½¿ç”¨æœ¬å·¥å…·å¯¼è‡´çš„ç›´æŽ¥æˆ–é—´æŽ¥æŸå¤±è´Ÿè´£ã€‚

---

**å¦‚æžœè§‰å¾—è¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹ä¸ª Star â­ï¸ æ”¯æŒä¸€ä¸‹ï¼**
